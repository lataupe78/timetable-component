var tabletime=function(e){"use strict";function t(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var l=s.call(e,t||"default");if("object"!=typeof l)return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.dayWeek=parseInt(e?.dayWeek,10),this.is_valid=this.dayWeek>=0&&this.dayWeek<=6,this.hours=e?.hours||[],this.is_closed=this.hours.length,this.label="Day",console.log({"Day constructor":e,dayWeek:this.dayWeek})}setLabel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.is_valid||(this.label="Invalid Day"),this.label=e[this.dayWeek],console.log({"Day setLabel":this.label})}}t(s,"label",void 0),t(s,"dayWeek",void 0),t(s,"is_valid",void 0),t(s,"hours",void 0);class l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"fr",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.timeZoneFallBack="Europe/Paris",this.clientTimeZone=this.getClientTimeZoneFromBrowser(),this.locale=e??this.getNavigatorLanguage(),this.timeZone=t??this.getClientTimeZoneFromBrowser(),this.checkTimeZoneIsValid()}checkTimeZoneIsValid(){try{new Intl.DateTimeFormat(this.locale,{timeZone:this.timeZone}).format(new Date)}catch(e){console.error(e+" - Switching to "+this.timeZoneFallBack),this.timeZone=this.timeZoneFallBack}}getClientTimeZoneFromBrowser(){return Intl.DateTimeFormat().resolvedOptions().timeZone}getNavigatorLanguage(){return Intl.DateTimeFormat().resolvedOptions().locale||"en"}}class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"fr";this.locale=e,this.days=this.getDaysLabelsLocalized(),this.labels=this.getLocalizedLabels()}getDaysLabelsLocalized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"long";const t=new Intl.DateTimeFormat(this.locale,{weekday:e}).format;return[...Array(7).keys()].map((e=>t(new Date(Date.UTC(2022,11,4+e)))))}getLocalizedLabels(){const e={en:{open:"Open",closed:"Closed",title:"opening time",opens_at:"Opens {0} at {1}",closes_at:"Closes at {0}",close_soon:"Close Soon"},ar:{open:"افتح",closed:"مغلق",title:"وقت مفتوح",opens_at:"{1} الساعة {0} الساعة",closes_at:"يغلق الساعة {0}",close_soon:"يغلق قريبا"},th:{open:"เปิด",closed:"ปิด",title:"เวลาเปิด",opens_at:"เปิด{0} เวลา {1} น",close_at:"ปิดเวลา {0} น",close_soon:"ปิดเร็ว ๆ นี้"},fr:{open:"Ouvert",closed:"Fermé",title:"horaires d'ouverture",opens_at:"Ouvre {0} à {1}",closes_at:"Ferme à {0}",close_soon:"Ferme bientôt"},ja:{open:"開いた",closed:"開いた",title:"開始時間",opens_at:"{0}は{1}開店",closes_at:"{0}時閉店",close_soon:"すぐに閉まります"},zh:{open:"打开",closed:"关闭",title:"营业时间",opens_at:"{0} {1} 开门",closes_at:"{0}关门",close_soon:"即将关门"}};let t=this.locale.slice(0,2),s=e?.[t];return null==s&&(console.error(`Locale ${t} not found in translations - Default to english.`),s=e.en),s}format(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";for(var t=arguments.length,s=new Array(t>1?t-1:0),l=1;l<t;l++)s[l-1]=arguments[l];return e.replace(/{(\d+)}/g,(function(e,t){return void 0!==s[t]?s[t]:e}))}}class a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};console.log({"HourRange constructor range":e}),this.intlOptions={hour:"numeric",minute:"numeric",locale:"zh-TW",timeZone:"Australia/Sydney",clientTimezone:"Asia/Dubai",...t},this.isValid=!0,this.start=this.setTimeParts(e?.start),this.end=this.setTimeParts(e?.end)}setTimeParts(){let e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"12:00").split(":"),t=parseInt(e[0],10),s=parseInt(e[1],10),l=new Date;return l.setHours(t,s,0),{time:60*t+s,hours:t,minutes:s,label:new Intl.DateTimeFormat(this.intlOptions.locale,this.intlOptions).format(l)}}}return e.TimeTable=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.settings=new l(e?.locale,e?.timeZone),this.showTitle=e?.showTitle??!1,this.labels=new i(this.settings.locale),this.tableEl=e?.tableEl,null==this.tableEl)throw new Error("HTMLElement for table is not defined.");this.statusEl=e?.statusEl,this.currentDate=new Date,this.currentDay=null,this.currentHours=null,this.hoursRange=new Array,this.days=this.sortDays(e?.days),console.log({params:e,days:this.days,settings:this.settings,labels:this.labels}),this.displayDays(),this.displayStatus()}checkisOpen(){let e=this.currentDate.getTime(),t=this.currentDate.getDay(),s=!1,l=null,i=null,a=this.days.findIndex((e=>e.dayWeek==t));if(this.currentDay=this.days[a],0==this.currentDay.hours.length)return!1;for(let t=0;t<this.currentDay?.hours?.length;t++)if(this.currentHours=this.currentDay?.hours[t],l=this.setTimeParts(new Date,this.currentHours?.start).getTime(),i=this.setTimeParts(new Date,this.currentHours?.end).getTime(),e>=l&&e<=i){s=!0;break}return console.log({currentDay:this.currentDay,currentHours:this.currentHours,isOpen:s,startTime:l,endTime:i}),s}displayStatus(){let e="",t=this.checkisOpen();e+=t?`<span class="is-open">&check; ${this.labels?.labels?.open}</span>`:`<span class="is-closed">&cross; ${this.labels?.labels?.closed}</span>`;let l=this.getHourRangeIndex();if(console.log({hourRangeIndex:l,currentHour:this.hoursRange[l]}),t){let t=this.labels.format(this.labels?.labels?.closes_at,this.hoursRange[l].end?.label);console.log(t),e+=t}else{l=(l+1)%this.hoursRange.length;for(let t=l;t<this.hoursRange.length;t++){let i=this.hoursRange[t];if(i?.start){let t=new s({dayWeek:i?.dayWeek});t.setLabel(this.labels.days);let a=t.label,o=this.labels.format(this.labels?.labels?.opens_at,a,this.hoursRange[l].start?.label);console.log(o),e+=o;break}}}this.statusEl.innerHTML=e}displayDays(){let e="";this.showTitle&&(e+=`<caption>${this.labels?.labels?.title}</caption>`),e+="<tbody>",this.days.forEach((t=>{e+=`<tr class="${t.is_closed?"is-closed":"is-open"}">\n        <td class="label__day">${t.label}</td>\n        <td class="label__hours">`,0==t?.hours?.length?e+=this.labels?.labels?.closed||"Closed":t.hours.forEach((t=>{e+=`\n     <div class="timetable__hour_range">\n        <time datetime="${t?.start?.label}">${t?.start?.label}</time> - \n        <time datetime="${t?.start?.label}">${t?.end?.label}</time>\n     </div>\n     `})),e+="</td></tr>"})),e+="</tbody>",this.tableEl.style.direction=new Intl.Locale(this.settings.locale).textInfo.direction,this.tableEl.innerHTML=e}sortDays(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=new Array;e.forEach((e=>{let l=new s(e,this.settings.locale);l.is_valid&&l.setLabel(this.labels.days);let i=new Array;e?.hours?.forEach((e=>{let t=new a(e,{timeZone:this.settings.timeZone,clientTimezone:this.settings.clientTimeZone,locale:this.settings.locale});i.push(t)})),l.hours=i,t.push(l)}));let l=[6,0,1,2,3,4,5];t.sort(((e,t)=>l[e?.dayWeek]>l[t?.dayWeek]?1:l[t?.dayWeek]>l[e?.dayWeek]?-1:0));var i=this.hoursRange;return t.forEach((e=>{let t=e?.hours;t.sort(((e,t)=>e?.start.time>t?.start.time?1:t?.start.time>e?.start.time?-1:0)),console.log({hoursRangeList:i});for(let s=0;s<t.length;s++)i.push({...t[s],dayWeek:e?.dayWeek})})),t}getHourRangeIndex(){return this.hoursRange.findIndex((e=>(console.log({dayWeek:e.dayWeek,start:e.hours?.start,end:e.hours?.end}),null==this.currentHours||null==this.currentHours?e?.dayWeek==this.currentDay?.dayWeek:e?.dayWeek==this.currentDay?.dayWeek&&e?.start==this.currentHours?.start&&e?.end===this.currentHours?.end)))}setTimeParts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return console.log({"setTimeParts time":t}),e.setHours(t?.hours,t?.minutes,0),e}},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
