function e(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),l.push.apply(l,s)}return l}function t(t){for(var s=1;s<arguments.length;s++){var o=null!=arguments[s]?arguments[s]:{};s%2?e(Object(o),!0).forEach((function(e){l(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function l(e,t,l){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var l=e[Symbol.toPrimitive];if(void 0!==l){var s=l.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.dayWeek=parseInt(null==e?void 0:e.dayWeek,10),this.is_valid=this.dayWeek>=0&&this.dayWeek<=6,this.hours=(null==e?void 0:e.hours)||[],this.is_closed=this.hours.length,this.label="Day",console.log({"Day constructor":e,dayWeek:this.dayWeek})}setLabel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.is_valid||(this.label="Invalid Day"),this.label=e[this.dayWeek],console.log({"Day setLabel":this.label})}}l(s,"label",void 0),l(s,"dayWeek",void 0),l(s,"is_valid",void 0),l(s,"hours",void 0);class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"fr",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.timeZoneFallBack="Europe/Paris",this.clientTimeZone=this.getClientTimeZoneFromBrowser(),this.locale=null!=e?e:this.getNavigatorLanguage(),this.timeZone=null!=t?t:this.getClientTimeZoneFromBrowser(),this.checkTimeZoneIsValid()}checkTimeZoneIsValid(){try{new Intl.DateTimeFormat(this.locale,{timeZone:this.timeZone}).format(new Date)}catch(e){console.error(e+" - Switching to "+this.timeZoneFallBack),this.timeZone=this.timeZoneFallBack}}getClientTimeZoneFromBrowser(){return Intl.DateTimeFormat().resolvedOptions().timeZone}getNavigatorLanguage(){return Intl.DateTimeFormat().resolvedOptions().locale||"en"}}class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"fr";this.locale=e,this.days=this.getDaysLabelsLocalized(),this.labels=this.getLocalizedLabels()}getDaysLabelsLocalized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"long";const t=new Intl.DateTimeFormat(this.locale,{weekday:e}).format;return[...Array(7).keys()].map((e=>t(new Date(Date.UTC(2022,11,4+e)))))}getLocalizedLabels(){const e={en:{open:"Open",closed:"Closed",title:"opening time",opens_at:"Opens {0} at {1}",closes_at:"Closes at {0}",close_soon:"Close Soon"},ar:{open:"افتح",closed:"مغلق",title:"وقت مفتوح",opens_at:"{1} الساعة {0} الساعة",closes_at:"يغلق الساعة {0}",close_soon:"يغلق قريبا"},th:{open:"เปิด",closed:"ปิด",title:"เวลาเปิด",opens_at:"เปิด{0} เวลา {1} น",close_at:"ปิดเวลา {0} น",close_soon:"ปิดเร็ว ๆ นี้"},fr:{open:"Ouvert",closed:"Fermé",title:"horaires d'ouverture",opens_at:"Ouvre {0} à {1}",closes_at:"Ferme à {0}",close_soon:"Ferme bientôt"},ja:{open:"開いた",closed:"開いた",title:"開始時間",opens_at:"{0}は{1}開店",closes_at:"{0}時閉店",close_soon:"すぐに閉まります"},zh:{open:"打开",closed:"关闭",title:"营业时间",opens_at:"{0} {1} 开门",closes_at:"{0}关门",close_soon:"即将关门"}};let t=this.locale.slice(0,2),l=null==e?void 0:e[t];return null==l&&(console.error("Locale ".concat(t," not found in translations - Default to english.")),l=e.en),l}format(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";for(var t=arguments.length,l=new Array(t>1?t-1:0),s=1;s<t;s++)l[s-1]=arguments[s];return e.replace(/{(\d+)}/g,(function(e,t){return void 0!==l[t]?l[t]:e}))}}class n{constructor(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};console.log({"HourRange constructor range":e}),this.intlOptions=t(t({},{hour:"numeric",minute:"numeric",locale:"zh-TW",timeZone:"Australia/Sydney",clientTimezone:"Asia/Dubai"}),l),this.isValid=!0,this.start=this.setTimeParts(null==e?void 0:e.start),this.end=this.setTimeParts(null==e?void 0:e.end)}setTimeParts(){let e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"12:00").split(":"),t=parseInt(e[0],10),l=parseInt(e[1],10),s=new Date;return s.setHours(t,l,0),{time:60*t+l,hours:t,minutes:l,label:new Intl.DateTimeFormat(this.intlOptions.locale,this.intlOptions).format(s)}}}class r{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.settings=new o(null==t?void 0:t.locale,null==t?void 0:t.timeZone),this.showTitle=null!==(e=null==t?void 0:t.showTitle)&&void 0!==e&&e,this.labels=new i(this.settings.locale),this.tableEl=null==t?void 0:t.tableEl,null==this.tableEl)throw new Error("HTMLElement for table is not defined.");this.statusEl=null==t?void 0:t.statusEl,this.currentDate=new Date,this.currentDay=null,this.currentHours=null,this.hoursRange=new Array,this.days=this.sortDays(null==t?void 0:t.days),console.log({params:t,days:this.days,settings:this.settings,labels:this.labels}),this.displayDays(),this.displayStatus()}checkisOpen(){let e=this.currentDate.getTime(),t=this.currentDate.getDay(),l=!1,s=null,o=null,i=this.days.findIndex((e=>e.dayWeek==t));if(this.currentDay=this.days[i],0==this.currentDay.hours.length)return!1;for(let t=0;t<(null===(n=this.currentDay)||void 0===n||null===(r=n.hours)||void 0===r?void 0:r.length);t++){var n,r,a,u,d;if(this.currentHours=null===(a=this.currentDay)||void 0===a?void 0:a.hours[t],s=this.setTimeParts(new Date,null===(u=this.currentHours)||void 0===u?void 0:u.start).getTime(),o=this.setTimeParts(new Date,null===(d=this.currentHours)||void 0===d?void 0:d.end).getTime(),e>=s&&e<=o){l=!0;break}}return console.log({currentDay:this.currentDay,currentHours:this.currentHours,isOpen:l,startTime:s,endTime:o}),l}displayStatus(){var e,t,l,o;let i="",n=this.checkisOpen();i+=n?'<span class="is-open">&check; '.concat(null===(e=this.labels)||void 0===e||null===(t=e.labels)||void 0===t?void 0:t.open,"</span>"):'<span class="is-closed">&cross; '.concat(null===(l=this.labels)||void 0===l||null===(o=l.labels)||void 0===o?void 0:o.closed,"</span>");let r=this.getHourRangeIndex();if(console.log({hourRangeIndex:r,currentHour:this.hoursRange[r]}),n){var a,u,d;let e=this.labels.format(null===(a=this.labels)||void 0===a||null===(u=a.labels)||void 0===u?void 0:u.closes_at,null===(d=this.hoursRange[r].end)||void 0===d?void 0:d.label);console.log(e),i+=e}else{r=(r+1)%this.hoursRange.length;for(let e=r;e<this.hoursRange.length;e++){let t=this.hoursRange[e];if(null!=t&&t.start){var c,h,v;let e=new s({dayWeek:null==t?void 0:t.dayWeek});e.setLabel(this.labels.days);let l=e.label,o=this.labels.format(null===(c=this.labels)||void 0===c||null===(h=c.labels)||void 0===h?void 0:h.opens_at,l,null===(v=this.hoursRange[r].start)||void 0===v?void 0:v.label);console.log(o),i+=o;break}}}this.statusEl.innerHTML=i}displayDays(){let e="";var t,l;this.showTitle&&(e+="<caption>".concat(null===(t=this.labels)||void 0===t||null===(l=t.labels)||void 0===l?void 0:l.title,"</caption>"));e+="<tbody>",this.days.forEach((t=>{var l,s,o;(e+='<tr class="'.concat(t.is_closed?"is-closed":"is-open",'">\n        <td class="label__day">').concat(t.label,'</td>\n        <td class="label__hours">'),0==(null==t||null===(l=t.hours)||void 0===l?void 0:l.length))?e+=(null===(s=this.labels)||void 0===s||null===(o=s.labels)||void 0===o?void 0:o.closed)||"Closed":t.hours.forEach((t=>{var l,s,o,i;e+='\n     <div class="timetable__hour_range">\n        <time datetime="'.concat(null==t||null===(l=t.start)||void 0===l?void 0:l.label,'">').concat(null==t||null===(s=t.start)||void 0===s?void 0:s.label,'</time> - \n        <time datetime="').concat(null==t||null===(o=t.start)||void 0===o?void 0:o.label,'">').concat(null==t||null===(i=t.end)||void 0===i?void 0:i.label,"</time>\n     </div>\n     ")}));e+="</td></tr>"})),e+="</tbody>",this.tableEl.style.direction=new Intl.Locale(this.settings.locale).textInfo.direction,this.tableEl.innerHTML=e}sortDays(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],l=new Array;e.forEach((e=>{var t;let o=new s(e,this.settings.locale);o.is_valid&&o.setLabel(this.labels.days);let i=new Array;null==e||null===(t=e.hours)||void 0===t||t.forEach((e=>{let t=new n(e,{timeZone:this.settings.timeZone,clientTimezone:this.settings.clientTimeZone,locale:this.settings.locale});i.push(t)})),o.hours=i,l.push(o)}));let o=[6,0,1,2,3,4,5];l.sort(((e,t)=>o[null==e?void 0:e.dayWeek]>o[null==t?void 0:t.dayWeek]?1:o[null==t?void 0:t.dayWeek]>o[null==e?void 0:e.dayWeek]?-1:0));var i=this.hoursRange;return l.forEach((e=>{let l=null==e?void 0:e.hours;l.sort(((e,t)=>(null==e?void 0:e.start.time)>(null==t?void 0:t.start.time)?1:(null==t?void 0:t.start.time)>(null==e?void 0:e.start.time)?-1:0)),console.log({hoursRangeList:i});for(let s=0;s<l.length;s++)i.push(t(t({},l[s]),{dayWeek:null==e?void 0:e.dayWeek}))})),l}getHourRangeIndex(){return this.hoursRange.findIndex((e=>{var t,l,s,o,i,n;return console.log({dayWeek:e.dayWeek,start:null===(t=e.hours)||void 0===t?void 0:t.start,end:null===(l=e.hours)||void 0===l?void 0:l.end}),null==this.currentHours||null==this.currentHours?(null==e?void 0:e.dayWeek)==(null===(n=this.currentDay)||void 0===n?void 0:n.dayWeek):(null==e?void 0:e.dayWeek)==(null===(s=this.currentDay)||void 0===s?void 0:s.dayWeek)&&(null==e?void 0:e.start)==(null===(o=this.currentHours)||void 0===o?void 0:o.start)&&(null==e?void 0:e.end)===(null===(i=this.currentHours)||void 0===i?void 0:i.end)}))}setTimeParts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return console.log({"setTimeParts time":t}),e.setHours(null==t?void 0:t.hours,null==t?void 0:t.minutes,0),e}}export{r as TimeTable};
